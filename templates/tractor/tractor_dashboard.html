{% extends "base.html" %}
{% block tractor %}active{% endblock %}
{% block tractor_dashboard %}active{% endblock %}

{% block content %}
<div class="content-wrapper p-4" style="padding-left: 15px;">

    <!-- Page Header -->
    <section class="content-header mb-3">
        <h3>ٹریکٹر نظام ڈیش بورڈ</h3>
    </section>

    <!-- Quick Actions -->
    <div class="mb-4 d-flex flex-wrap gap-2">
        <a href="{% url 'tractor:employee_create' %}" class="btn btn-primary">مزدور شامل کریں</a>
        <a href="{% url 'tractor:customer_create' %}" class="btn btn-success">گاہک شامل کریں</a>
        <a href="{% url 'tractor:tractor_create' %}" class="btn btn-warning">ٹریکٹر شامل کریں</a>
        <a href="{% url 'tractor:trip_create' %}" class="btn btn-info">چکر شامل کریں</a>
        <a href="{% url 'tractor:advance_create' %}" class="btn btn-primary">ایڈوانس شامل کریں</a>
        <a href="{% url 'tractor:payment_create' %}" class="btn btn-success">ادائیگی شامل کریں</a>
        <a href="{% url 'tractor:add_loan' %}" class="btn btn-danger">پیشگی شامل کریں</a>
        <a href="{% url 'tractor:add_saving' %}" class="btn btn-success">جمع شامل کریں</a>

        <a href="{% url 'tractor:weekly_summary' %}" class="btn btn-warning">ہفتہ وار خلاصہ</a>
    </div>

    <!-- Customer Filter -->
     <br>
    <form method="get" class="mb-4 d-flex align-items-center gap-2">
        <select name="customer" class="form-control" style="max-width: 300px;">
            <option value="">گاہک</option>
            {% for c in customers %}
            <option value="{{ c.id }}" {% if selected_customer and selected_customer.id == c.id %}selected{% endif %}>
                {{ c.name }}
            </option>
            {% endfor %}
        </select>
        <br>
        <button class="btn btn-primary">Filter</button>

        {% if selected_customer %}
        <a href="{% url 'tractor:dashboard' %}" class="btn btn-outline-danger">Clear</a>
        {% endif %}
    </form>

    <!-- ========================== -->
    <!-- EMPLOYEE TABLE -->
    <!-- ========================== -->
    <div class="card mb-4 shadow border-primary">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">مزدور کے چکر اور ادائیگیاں</h3>
        </div>

        <div class="card-body p-0 table-responsive">
            <table class="table table-striped table-hover text-center mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>مزدور</th>
                        <th>کُل ٹرپ کی رقم</th>
                        <th>ایڈوانس</th>
                        <th>ادائیگی</th>
                        <th>باقی</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    {% for row in employee_page_obj %}
                    <tr>
                        <td>{{ row.employee.name }}</td>
                        <td>₹{{ row.total_trip_amount|floatformat:0 }}</td>
                        <td>₹{{ row.advance|floatformat:0 }}</td>
                        <td>₹{{ row.paid|floatformat:0 }}</td>
                        <td>₹{{ row.remaining|floatformat:0 }}</td>
                        <td>
                            <a href="{% url 'tractor:employee_ledger' row.employee.id %}" class="btn btn-sm btn-primary mb-1">کھاتہ</a>
                            <a href="{% url 'tractor:payment_create' %}?employee={{ row.employee.id }}" class="btn btn-sm btn-success mb-1">Pay</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6">No employees found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="py-2 d-flex justify-content-center">
            {% if employee_page_obj.has_previous %}
            <a href="?emp_page={{ employee_page_obj.previous_page_number }}" class="btn btn-sm btn-outline-primary mx-1">Previous</a>
            {% endif %}

            <span class="mx-2">Page {{ employee_page_obj.number }} of {{ employee_page_obj.paginator.num_pages }}</span>

            {% if employee_page_obj.has_next %}
            <a href="?emp_page={{ employee_page_obj.next_page_number }}" class="btn btn-sm btn-outline-primary mx-1">Next</a>
            {% endif %}
        </div>
    </div>

    <!-- ========================== -->
    <!-- CUSTOMER LEDGER TABLE -->
    <!-- ========================== -->
    <div class="card mb-4 shadow border-success">
        <div class="card-header bg-success text-white">
            <h3 class="mb-0">گاہک</h3>
        </div>

        <div class="card-body p-0 table-responsive">
            <table class="table table-striped table-hover text-center mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>گاہک</th>
                        <th>کُل ٹرپ کی رقم</th>
                        <th>ادائیگی</th>
                        <th>باقی</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    {% for cust in customer_page_obj %}
                    <tr>
                        <td>
                            {{ cust.customer.name }}<br>
                            <small>{{ cust.customer.phone }} | {{ cust.customer.address }}</small>
                        </td>
                        <td>₹{{ cust.total_trip_amount|floatformat:0 }}</td>
                        <td>₹{{ cust.total_paid|floatformat:0 }}</td>
                        <td>₹{{ cust.balance|floatformat:0 }}</td>
                        <td>
                            <a href="{% url 'tractor:customer_ledger' cust.customer.id %}" class="btn btn-sm btn-primary mb-1">کھاتہ</a>
                            <!-- <a href="{% url 'tractor:payment_create' %}?customer={{ cust.customer.id }}" class="btn btn-sm btn-success mb-1">Pay</a> -->
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5">No customers found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="py-2 d-flex justify-content-center">
            {% if customer_page_obj.has_previous %}
            <a href="?cust_page={{ customer_page_obj.previous_page_number }}" class="btn btn-sm btn-outline-primary mx-1">Previous</a>
            {% endif %}

            <span class="mx-2">Page {{ customer_page_obj.number }} of {{ customer_page_obj.paginator.num_pages }}</span>

            {% if customer_page_obj.has_next %}
            <a href="?cust_page={{ customer_page_obj.next_page_number }}" class="btn btn-sm btn-outline-primary mx-1">Next</a>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}
