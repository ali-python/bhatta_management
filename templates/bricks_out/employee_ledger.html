{% extends 'base.html' %}
{% block brickout %}active{% endblock %}
{% block employee_list %}active{% endblock %}
{% block content %}
{% load static %}

<style>
    .summary-card {
        padding: 15px;
        border-radius: 8px;
        background: #f2f6ff;
        border-left: 5px solid #3c8dbc;
        margin-bottom: 20px;
    }
    .week-box {
        border: 1px solid #dcdcdc;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        background: #fcfcfc;
    }
    .week-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #3f51b5;
    }
    .pagination li {
        display: inline-block;
        margin: 0 2px;
    }
    .pagination li.active a {
        font-weight: bold;
        color: #fff;
        background: #3c8dbc;
        border-radius: 3px;
        padding: 3px 8px;
        text-decoration: none;
    }
    .pagination li a {
        text-decoration: none;
        padding: 3px 8px;
    }
</style>

<div class="content-wrapper">

<section class="content-header">
    <ol class="breadcrumb">
        <li><a href="{% url 'common:index' %}"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="{% url 'employee:list' %}">Ù…Ø²Ø¯ÙˆØ±</a></li>
        <li class="active">{{ employee.name }}'s Ú©Ú¾Ø§ØªÛ</li>
    </ol>
</section>
<br><br>

<section class="content">
    <div class="box">

        <div class="box-header text-center">
            <h2><b>{{ employee.name }}</b></h2>
            <p>ğŸ“ {{ employee.phone }} &nbsp; | &nbsp; ğŸ  {{ employee.address }}</p>
        </div>

        <div class="text-center" style="margin-top:10px;">
            <a href="{% url 'payment:payment_add' %}?employee={{ employee.id }}" class="btn btn-success">+ Make Payment</a>
            <a href="{% url 'bricks_out:add_saving' %}?employee={{ employee.id }}" class="btn btn-success">+ Saving</a>
        </div>

        <div class="box-body">

            <!-- Summary -->
            <div class="summary-card">
                <h4><b>Ø®Ù„Ø§ØµÛ</b></h4>
                <table class="table table-bordered">
                    <tr>
                        <th>Ú©ÙÙ„ Ø§ÛŒÙ†Ù¹ÛŒÚº</th>
                        <th>Ú©Ù…Ø§Ø¦ÛŒ (â‚¹)</th>
                        <th>Ú©ÙÙ„ Ú©Ù¹ÙˆØªÛŒ (â‚¹)</th>
                        <th>Ú©ÙÙ„ Ø®Ø±Ú†Û (â‚¹)</th>
                        <th>Ù¾ÛŒØ´Ú¯ÛŒ</th>
                        <th>Ø¬Ù…Ø¹</th>
                        <th>Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒ Ø±Ù‚ÙˆÙ… (â‚¹)</th>
                        <th>Ø¨Ù‚ÛŒÛ Ø±Ù‚ÙˆÙ… (â‚¹)</th>
                    </tr>
                    <tr>
                        {% if week_data.has_other_pages or week_data.number > 1 %}
                            <!-- NOT first week â†’ only loan + saving -->
                            <td>0</td>
                            <td><b>â‚¹0</b></td>
                            <td style="color:orange;">â‚¹0</td>
                            <td style="color:purple;">â‚¹0</td>
                            <td style="color:rgb(128, 19, 0);">â‚¹{{ total_loan|floatformat:0 }}</td>
                            <td style="color:rgb(47, 148, 0);">â‚¹{{ total_saving|floatformat:0 }}</td>
                            <td style="color:blue;">â‚¹0</td>
                            <td><b style="color:green;">â‚¹0</b></td>
                        {% else %}
                            <!-- FIRST WEEK â†’ show full summary -->
                            <td>{{ total_bricks }}</td>
                            <td><b>â‚¹{{ total_amount|floatformat:2 }}</b></td>
                            <td style="color:orange;">â‚¹{{ total_deducted|floatformat:0 }}</td>
                            <td style="color:purple;">â‚¹{{ total_advance|floatformat:0 }}</td>
                            <td style="color:rgb(128, 19, 0);">â‚¹{{ total_loan|floatformat:0 }}</td>
                            <td style="color:rgb(47, 148, 0);">â‚¹{{ total_saving|floatformat:0 }}</td>
                            <td style="color:blue;">â‚¹{{ total_paid|floatformat:0 }}</td>
                            <td><b style="color:green;">â‚¹{{ balance|floatformat:0 }}</b></td>
                        {% endif %}
                    </tr>
                </table>
            </div>

            <hr>

            <!-- WEEK-WISE -->
            <h3><b>Ø§ÙÛŒÙ†Ù¹ Ú©Ø§ Ú©Ø§Ù… (ÛÙØªÛ ÙˆØ§Ø±)</b></h3>
            {% for week in week_data %}
            <div class="week-box">
                <div class="week-title">
                    Week {{ week.week_number }}  
                    <small>({{ week.week_start }} â†’ {{ week.week_end }})</small>
                </div>
                <h4 style="color:green;"><b>Ú©ÙÙ„ Ø§ÛŒÙ†Ù¹ÛŒÚº:</b> {{ week.week_bricks }}</h4>

                {% if week.works %}
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                            <th>Ø§ÙÛŒÙ†Ù¹ Ú©ÛŒ Ù‚ÙØ³Ù…</th>
                            <th>Ø±ÛŒÙ¹</th>
                            <th>Ø±Ù‚Ù…</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for w in week.works %}
                        <tr>
                            <td>{{ w.date }}</td>
                            <td>{{ w.quantity }}</td>
                            <td>{{ w.brick_type }}</td>
                            <td>â‚¹{{ w.rate.rate_per_1000 }}</td>
                            <td>â‚¹{{ w.calculate_amount|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                        <tr style="background:#eef2ff;">
                            <td colspan="3"><b>Weekly Total</b></td>
                            <td colspan="2"><b>â‚¹{{ week.week_total|floatformat:0 }}</b></td>
                        </tr>
                    </tbody>
                </table>
                {% else %}
                <p>No work done this week.</p>
                {% endif %}
            </div>
            {% endfor %}

            {% if week_data.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if week_data.has_previous %}
                        <li><a href="?weeks_page={{ week_data.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in week_data.paginator.page_range %}
                        <li class="{% if week_data.number == i %}active{% endif %}">
                            <a href="?weeks_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if week_data.has_next %}
                        <li><a href="?weeks_page={{ week_data.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            <hr>

            <!-- ADVANCES -->
            <h3><b>Ø®Ø±Ú†Û</b></h3>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø±Ù‚Ù… (â‚¹)</th></tr>
                </thead>
                <tbody>
                    {% for adv in advances %}
                    <tr>
                        <td>{{ adv.date }}</td>
                        <td>â‚¹{{ adv.amount|floatformat:0 }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="2" class="text-center">No advances found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if advances.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if advances.has_previous %}
                        <li><a href="?adv_page={{ advances.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in advances.paginator.page_range %}
                        <li class="{% if advances.number == i %}active{% endif %}">
                            <a href="?adv_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if advances.has_next %}
                        <li><a href="?adv_page={{ advances.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            <hr>

            <!-- ADVANCE DEDUCTIONS -->
            <h3><b>Ú©Ù¹ÙˆØªÛŒ</b></h3>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</th><th>Ú©Ù¹ÙˆØªÛŒ Ú©ÛŒ Ø±Ù‚Ù… (â‚¹)</th></tr>
                </thead>
                <tbody>
                    {% for ded in deductions %}
                    <tr>
                        <td>{{ ded.date }}</td>
                        <td>â‚¹{{ ded.payment.amount|floatformat:0 }}</td>
                        <td style="color:orange;">â‚¹{{ ded.amount|floatformat:0 }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center">No deductions found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if deductions.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if deductions.has_previous %}
                        <li><a href="?ded_page={{ deductions.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in deductions.paginator.page_range %}
                        <li class="{% if deductions.number == i %}active{% endif %}">
                            <a href="?ded_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if deductions.has_next %}
                        <li><a href="?ded_page={{ deductions.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            <hr>

            <!-- LOANS -->
            <h3><b>Ù¾ÛŒØ´Ú¯ÛŒ</b></h3>
            <h3 style="color:Green"><b>{{ total_loan|floatformat:0 }}</b></h3>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø±Ù‚Ù… (â‚¹)</th><th>Ù†ÙˆÙ¹</th></tr>
                </thead>
                <tbody>
                    {% for loan in loans %}
                    <tr>
                        <td>{{ loan.date }}</td>
                        <td style="color:red;">â‚¹{{ loan.amount|floatformat:0 }}</td>
                        <td>{{ loan.note|default:"â€”" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center">No loan records found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if loans.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if loans.has_previous %}
                        <li><a href="?loan_page={{ loans.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in loans.paginator.page_range %}
                        <li class="{% if loans.number == i %}active{% endif %}">
                            <a href="?loan_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if loans.has_next %}
                        <li><a href="?loan_page={{ loans.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            <hr>

            <!-- SAVINGS -->
            <h3><b>Ø¬Ù…Ø¹</b></h3>
            <h3 style="color:Green"><b>{{ total_saving|floatformat:0 }}</b></h3>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø±Ù‚Ù… (â‚¹)</th></tr>
                </thead>
                <tbody>
                    {% for save in savings %}
                    <tr>
                        <td>{{ save.date }}</td>
                        <td style="color:green;">â‚¹{{ save.amount|floatformat:0 }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="2" class="text-center">No savings found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if savings.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if savings.has_previous %}
                        <li><a href="?saving_page={{ savings.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in savings.paginator.page_range %}
                        <li class="{% if savings.number == i %}active{% endif %}">
                            <a href="?saving_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if savings.has_next %}
                        <li><a href="?saving_page={{ savings.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            <hr>

            <!-- PAYMENTS -->
            <h3><b>Ø±Ù‚Ù… Ø§Ø¯Ø§ÛŒÚ¯ÛŒ</b></h3>
            <table class="table table-bordered table-striped">
                <thead>
                    <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ø±Ù‚Ù… (â‚¹)</th><th>Ù†ÙˆÙ¹</th></tr>
                </thead>
                <tbody>
                    {% for pay in payments %}
                    <tr>
                        <td>{{ pay.date }}</td>
                        <td>â‚¹{{ pay.amount|floatformat:0 }}</td>
                        <td>{{ pay.remarks|default:"â€”" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center">No payments found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if payments.paginator.num_pages > 1 %}
            <div class="text-center">
                <ul class="pagination">
                    {% if payments.has_previous %}
                        <li><a href="?pay_page={{ payments.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for i in payments.paginator.page_range %}
                        <li class="{% if payments.number == i %}active{% endif %}">
                            <a href="?pay_page={{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                    {% if payments.has_next %}
                        <li><a href="?pay_page={{ payments.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

        </div>
    </div>
</section>

</div>
{% endblock %}
